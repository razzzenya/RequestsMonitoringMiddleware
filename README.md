# Request Monitoring Middleware

ASP.NET Core middleware –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–æ–º–µ–Ω–æ–≤.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **Domain Checking Middleware** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –¥–æ–º–µ–Ω—É (allowed/greylisted/unauthorized)
- **Request Logging Middleware** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ OpenSearch
- **Serilog Integration** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **Aspire Orchestration** - –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
- **Integration Tests** - –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ —Å xUnit v3

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
RequestMonitoringMiddleware/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ RequestMonitoring.Library/      # Middleware –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ RequestMonitoring.AppHost/      # Aspire –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îú‚îÄ‚îÄ RequestMonitoring.Tests/        # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (xUnit v3)
‚îÇ   ‚îî‚îÄ‚îÄ Test.Api/                       # –¢–µ—Å—Ç–æ–≤–æ–µ API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ LOGGING.md                      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é
    ‚îú‚îÄ‚îÄ ASPIRE_GUIDE.md                 # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Aspire
    ‚îî‚îÄ‚îÄ TEST_SETUP.md                   # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–æ–º–µ–Ω–æ–≤
```

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

üìñ **[–ß–∏—Ç–∞–π—Ç–µ QUICKSTART.md –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏](QUICKSTART.md)**

### –ó–∞–ø—É—Å–∫ –∑–∞ 2 –∫–æ–º–∞–Ω–¥—ã:

```powershell
cd RequestMonitoring.AppHost
dotnet run
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è Aspire Dashboard: http://localhost:15888

### –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã:

```powershell
dotnet test
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[QUICKSTART.md](QUICKSTART.md)** - –ó–∞–ø—É—Å–∫ –∑–∞ 5 –º–∏–Ω—É—Ç ‚ö°
- **[ASPIRE_GUIDE.md](ASPIRE_GUIDE.md)** - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É –∏ –æ—Ç–ª–∞–¥–∫–µ üìñ
- **[LOGGING.md](LOGGING.md)** - –î–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é (Middleware vs Serilog) üìù
- **[TEST_SETUP.md](TEST_SETUP.md)** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ üß™
- **[FAQ.md](FAQ.md)** - –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º üí°

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- .NET 10
- ASP.NET Core
- Entity Framework Core (SQLite)
- OpenSearch
- Serilog
- .NET Aspire
- xUnit v3
- Docker

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:

### –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã API:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞ API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ OpenSearch –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

### Domain Middleware —Ç–µ—Å—Ç—ã:
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –æ—Ç allowed –¥–æ–º–µ–Ω–æ–≤ ‚Üí 200 OK
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –æ—Ç greylisted –¥–æ–º–µ–Ω–æ–≤ ‚Üí 402 Payment Required
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –æ—Ç blocked/unknown –¥–æ–º–µ–Ω–æ–≤ ‚Üí 401 Unauthorized
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ (localhost, IP)
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º

üìñ **[–ß–∏—Ç–∞–π—Ç–µ TEST_SETUP.md –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–æ–º–µ–Ω–æ–≤](TEST_SETUP.md)**

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Aspire Dashboard –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
- üìù –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
- üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- üîç –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞
- üê≥ –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### OpenSearch –∏–Ω–¥–µ–∫—Å—ã:
- `request-logs` - –¥–µ—Ç–∞–ª—å–Ω—ã–µ HTTP –º–µ—Ç—Ä–∏–∫–∏
- `app-logs-*` - –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üîê Domain Middleware

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ–º–µ–Ω –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∏:
- **200 OK** - –µ—Å–ª–∏ –¥–æ–º–µ–Ω –≤ whitelist (allowed)
- **402 Payment Required** - –µ—Å–ª–∏ –¥–æ–º–µ–Ω –≤ greylist
- **401 Unauthorized** - –µ—Å–ª–∏ –¥–æ–º–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ blocked

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞:

1. **Request Logging Middleware**
   - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
   - –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–º–µ—Ç–æ–¥, –ø—É—Ç—å, –∑–∞–≥–æ–ª–æ–≤–∫–∏, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ OpenSearch –∏–Ω–¥–µ–∫—Å `request-logs`

2. **Serilog —Å OpenSearch Sink**
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ OpenSearch –∏–Ω–¥–µ–∫—Å `app-logs-*`

## üöÄ Production Ready

- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Health checks
- ‚úÖ Graceful shutdown
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- ‚úÖ Docker support
- ‚úÖ Aspire orchestration

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

---

–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
